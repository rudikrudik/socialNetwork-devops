---
- name: "Service -> [{{ name }}]"
  community.docker.docker_container:
    name: "{{ name }}"
    image: "{{ name }}"
    state: started
    restart: yes
    ports:
      - "5432:5432"
    hostname: postresqlServer
    env:
      POSTGRES_DB: api
      POSTGRES_USER: "{{ postgres.user }}"
      POSTGRES_PASSwORD: "{{ postgres.superuser }}"
      PGDATA: "/var/lib/postgresql/data"
    volumes:
      - "{{ db_path }}:/var/lib/postgresql/data"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U {{ postgres.user }}"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 10s
    restart_policy: unless-stopped
  tags: "{{ name }}"